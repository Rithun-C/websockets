<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Websocket</title>
        <style>
            body{font-family: sans-serif; padding: 20px; background: #121212; color: #fff;}
            #log{background: #000; padding: 10px; height : 300px; overflow-y: scroll; border: 1px solid #fff;}
            .status-on{color: #00ff00;}
            .status-off{color:  #ff0000}
        </style>
    </head>
    <body>
        <h1>Websocket server console</h1>
        <p id="status" class="status-off">Connecting...</p>
        <form id="message-form">
            <input type="text" id="input-text" placeholder="echoo">
            <button type="submit">Deploy message...</button>
        </form>
        <h3>Live stream logs</h3>
        <pre id="log"></pre>
    </body>
    <script>
        const statusEl = document.getElementById('status');
        const log = document.getElementById('log');
        const input = document.getElementById('input-text')

        const socket = new WebSocket('ws://localhost:8080')
        const appendLog = (label, message) =>{
            const mess = `${new Date()} ${label} ${message}\n`;
            log.textContent = mess + log.textContent;
        }

        socket.addEventListener('open', () =>{
            statusEl.textContent = "Connected";
            statusEl.className = "status-on";
            appendLog("[SYSTEM]", "Tunnel opened");
        })

        socket.addEventListener('close', () =>{
            statusEl.textContent = "Disconneted";
            statusEl.className = "status-off";
            appendLog("[SYSTEM]", "Tunnel closed");
        })

        socket.addEventListener('message', (e) =>{
            appendLog("[RECEVIED]", e.data)
        })

        document.getElementById('message-form').addEventListener('submit', (e) =>{
            e.preventDefault();
            if(socket.readyState !== WebSocket.OPEN) {
                appendLog("[ERROR]", "No active tunnnel")
            }
            const text = input.value.trim();
            socket.send(text);  
            appendLog("[SENT]", text)
            input.value = "";
        })
    </script>

</html>